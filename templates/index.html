<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能交通流预测系统 - 后台管理</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link href="/static/css/admin.css" rel="stylesheet">
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-traffic-light"></i>
                智能交通流预测系统
            </a>
            
            <div class="ms-auto user-info">
                <div class="user-avatar" id="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <div id="user-name" class="user-name">加载中...</div>
                    <div id="user-role" class="user-role">...</div>
                </div>
                <div class="dropdown">
                    <button class="btn btn-link text-white" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-caret-down"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>个人中心</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>账户设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- 侧边栏 -->
    <aside class="sidebar">
        <ul class="sidebar-menu">
            <li>
                <a href="#" class="active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>数据概览</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="predict">
                    <i class="fas fa-chart-line"></i>
                    <span>实时预测</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="history">
                    <i class="fas fa-history"></i>
                    <span>历史记录</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="training">
                    <i class="fas fa-brain"></i>
                    <span>模型训练</span>
                </a>
            </li>
            <li>
                <a href="#" data-page="api">
                    <i class="fas fa-code"></i>
                    <span>API文档</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 数据概览页面 -->
        <div id="dashboard-page" class="page-content">
            <div class="page-header">
                <h1>数据概览</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item active">数据概览</li>
                    </ol>
                </nav>
            </div>

            <!-- 统计卡片 -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="label">总预测次数</div>
                                <div class="value" id="total-predictions">0</div>
                            </div>
                            <div class="icon text-primary">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card success">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="label">模型训练次数</div>
                                <div class="value" id="total-training">0</div>
                            </div>
                            <div class="icon text-success">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card warning">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="label">当前模型</div>
                                <div class="value" style="font-size: 20px;" id="current-model">LSTM</div>
                            </div>
                            <div class="icon text-warning">
                                <i class="fas fa-server"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card danger">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="label">系统状态</div>
                                <div class="value" style="font-size: 20px;">
                                    <span class="badge-success badge-custom">运行中</span>
                                </div>
                            </div>
                            <div class="icon text-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图表 -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card-custom">
                        <div class="card-header-custom">
                            <i class="fas fa-chart-line me-2"></i>
                            实时流量趋势
                        </div>
                        <div class="card-body-custom">
                            <div class="chart-container">
                                <canvas id="flowChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card-custom">
                        <div class="card-header-custom">
                            <i class="fas fa-pie-chart me-2"></i>
                            拥堵状态分布
                        </div>
                        <div class="card-body-custom">
                            <div class="chart-container">
                                <canvas id="congestionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 最近预测记录 -->
            <div class="card-custom mt-3">
                <div class="card-header-custom">
                    <i class="fas fa-list me-2"></i>
                    最近预测记录
                </div>
                <div class="card-body-custom">
                    <div class="table-responsive">
                        <table class="table-custom">
                            <thead>
                                <tr>
                                    <th>传感器ID</th>
                                    <th>预测流量</th>
                                    <th>道路密度</th>
                                    <th>拥堵状态</th>
                                    <th>置信度</th>
                                    <th>预测时间</th>
                                </tr>
                            </thead>
                            <tbody id="recent-predictions-table">
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="loading"></div>
                                        加载中...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 实时预测页面 -->
        <div id="predict-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>实时预测</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item active">实时预测</li>
                    </ol>
                </nav>
            </div>

            <div class="row">
                <div class="col-lg-6">
                    <div class="card-custom">
                        <div class="card-header-custom">
                            <i class="fas fa-cog me-2"></i>
                            预测设置
                        </div>
                        <div class="card-body-custom">
                            <div class="form-group-custom">
                                <label>传感器ID</label>
                                <input type="text" class="form-control-custom" id="sensor-id" value="sensor_001" placeholder="请输入传感器ID">
                                <small class="text-muted">用于标识预测的传感器位置</small>
                            </div>
                            
                            <div class="form-group-custom">
                                <label>模型选择</label>
                                <select class="form-control-custom" id="model-select">
                                    <option value="lstm">LSTM模型（长短期记忆网络）</option>
                                    <option value="gru">GRU模型（门控循环单元）</option>
                                </select>
                                <small class="text-muted">选择用于预测的深度学习模型</small>
                            </div>
                            
                            <div class="alert" style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 12px; margin-top: 15px;">
                                <i class="fas fa-database" style="color: #0ea5e9;"></i>
                                <strong style="color: #0c4a6e;">真实数据预测</strong>
                                <p style="margin: 8px 0 0 0; font-size: 13px; color: #075985;">
                                    点击下方按钮，系统将从PeMS04真实交通数据集中随机选择一段历史数据（12个时间步），并使用深度学习模型预测未来交通状态。
                                </p>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn-primary-custom" onclick="quickPredict()" style="width: 100%; padding: 15px; font-size: 16px;">
                                    <i class="fas fa-rocket me-2"></i>
                                    一键智能预测
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="card-custom">
                        <div class="card-header-custom">
                            <i class="fas fa-chart-pie me-2"></i>
                            预测结果
                        </div>
                        <div class="card-body-custom" id="prediction-result">
                            <div class="empty-state">
                                <i class="fas fa-chart-line fa-3x text-muted mb-3" style="opacity: 0.3;"></i>
                                <p class="text-muted mb-2">等待预测</p>
                                <small class="text-muted">点击左侧按钮开始预测</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 输入数据展示 -->
                    <div class="card-custom mt-3" id="input-data-card" style="display: none;">
                        <div class="card-header-custom">
                            <i class="fas fa-database me-2"></i>
                            输入数据（最近3个时间步）
                        </div>
                        <div class="card-body-custom">
                            <div id="input-data-display" style="font-size: 12px; font-family: monospace;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 历史记录页面 -->
        <div id="history-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>历史记录</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item active">历史记录</li>
                    </ol>
                </nav>
            </div>

            <div class="card-custom">
                <div class="card-header-custom">
                    <i class="fas fa-history me-2"></i>
                    预测历史查询
                </div>
                <div class="card-body-custom">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control-custom" id="history-sensor" placeholder="传感器ID（可选）">
                        </div>
                        <div class="col-md-4">
                            <input type="number" class="form-control-custom" id="history-limit" value="50" placeholder="记录数">
                        </div>
                        <div class="col-md-4">
                            <button class="btn-primary-custom w-100" onclick="loadHistory()">
                                <i class="fas fa-search me-2"></i>
                                查询
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table-custom">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>传感器ID</th>
                                    <th>预测流量</th>
                                    <th>预测密度</th>
                                    <th>拥堵状态</th>
                                    <th>置信度</th>
                                    <th>创建时间</th>
                                </tr>
                            </thead>
                            <tbody id="history-table">
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-search"></i>
                                            <p>点击查询按钮加载历史记录</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 模型训练页面 -->
        <div id="training-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>模型训练管理</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item active">模型训练</li>
                    </ol>
                </nav>
            </div>

            <div class="card-custom">
                <div class="card-header-custom">
                    <i class="fas fa-brain me-2"></i>
                    训练记录
                    <button class="btn-primary-custom float-end" onclick="loadTrainingHistory()">
                        <i class="fas fa-sync me-2"></i>
                        刷新
                    </button>
                </div>
                <div class="card-body-custom">
                    <div class="table-responsive">
                        <table class="table-custom">
                            <thead>
                                <tr>
                                    <th>模型名称</th>
                                    <th>模型版本</th>
                                    <th>开始时间</th>
                                    <th>最佳Epoch</th>
                                    <th>验证损失</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="training-table">
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-brain"></i>
                                            <p>点击刷新按钮加载训练记录</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- API文档页面 -->
        <div id="api-page" class="page-content" style="display: none;">
            <div class="page-header">
                <h1>API文档</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">首页</a></li>
                        <li class="breadcrumb-item active">API文档</li>
                    </ol>
                </nav>
            </div>

            <div class="card-custom">
                <div class="card-body-custom">
                    <h4>API Base URL</h4>
                    <code>http://127.0.0.1:8000</code>
                    
                    <h4 class="mt-4">可用接口</h4>
                    <div class="list-group mt-3">
                        <div class="list-group-item">
                            <h5>POST /predict</h5>
                            <p>单条预测</p>
                        </div>
                        <div class="list-group-item">
                            <h5>POST /predict/batch</h5>
                            <p>批量预测</p>
                        </div>
                        <div class="list-group-item">
                            <h5>GET /history/{sensor_id}</h5>
                            <p>查询传感器历史记录</p>
                        </div>
                        <div class="list-group-item">
                            <h5>GET /stats/summary</h5>
                            <p>获取系统统计信息</p>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="http://127.0.0.1:8000/docs" target="_blank" class="btn-primary-custom">
                            <i class="fas fa-book me-2"></i>
                            查看完整Swagger文档
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast通知容器 -->
    <div class="toast-container" id="toast-container"></div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- 自定义脚本 -->
    <script src="/static/js/admin.js"></script>
</body>
</html>

